## 目的
实现一个telnet命令自动执行桌面工具


## 生成的工具使用方法
1. 直接在cmd.xml修改目标telnet主机信息和要执行的telnet命令，然后执行cmdtnt.exe即可
2. 命令要telnet跳板操作另一台设备，则可以用nc命令，如：{ sleep 1; echo "root"; sleep 0.3; echo "4001862505";sleep 0.3; echo "ifconfig"; sleep 1; } | nc 2.0.0.2 23 | sed 's/~ #/- #/g'
3. 命令要telnet跳板操作另一台设备，还有另一种方法：{ sleep 1; echo "root"; sleep 0.3; echo "4001862505"; sleep 0.3; echo "ifconfig"; sleep 1; } | telnet 2.0.0.2 | sed 's/~ #/- #/g'
4. 注意：| sed 's/~ #/- #/g'，是因为执行完上面telnet命令的结果会出现提示符"~ #"内容，该工具每次命令读取结果是以提示符"~ #"判断，所以将telnet返回结果内容的"~ #"篡改掉，不然会影响后面的命令执行


## 工具说明
- **使用工具**：vscode、marscode（插件，豆包）
- **借鉴资源**：deepseek

## 提示词
### 任务概述
请生成完整可运行的 Python 代码，同时生成 `cmd.xml` 文件内容，以此实现一个具备图形用户界面（GUI）的 Telnet 客户端桌面应用程序。该应用允许用户输入目标主机的 IP 地址，点击执行按钮后建立 Telnet 连接，执行预设指令，并反馈执行结果。


### 详细需求说明


#### 配置文件 `cmd.xml` 要求
- **文件格式**：采用 XML 格式保存配置信息。
- **文件路径**：确保 `cmd.xml` 文件与 Python 脚本位于同一目录下，无论从哪个目录运行 Python 脚本，程序都能正确找到该配置文件。
- **文件内容**：包含以下字段及默认值：
    - `<window_title>`：Telnet自动化工具
    - `<ip_address>`：172.20.122.66
    - `<port>`：23
    - `<username>`：root
    - `<password>`：4001862505
    - `<commands>`：命令内容可以是多行，直接显示多行即可，不需要子节点，默认内容如下
ls -l /
ifconfig


#### 界面设计
1. **主窗口**
    - **窗口标题**：从 `cmd.xml` 文件中读取 `<window_title>` 字段的值作为主窗口标题。
    - **布局方式**：采用合理的布局（IP地址框、执行按钮放同一行），保证所有组件清晰展示，提升用户体验。组件布局需支持窗口缩放，能随窗口大小变化自适应调整位置和大小。
2. **IP地址框**
    - **IP 地址输入框**：提供一个输入框供用户输入目标主机的 IP 地址，输入框旁添加标签 “目标IP地址”。输入框的默认值从 `cmd.xml` 文件的 `<ip_address>` 字段获取。
3. **执行按钮**
    - **按钮功能**：创建一个名为 “执行” 的按钮。用户点击该按钮时，程序会根据用户输入的信息尝试建立 Telnet 连接。
    - **按钮状态变化**：点击按钮后，按钮文本变为 “执行中”；执行结束后，按钮文本恢复为 “执行”。执行结束后，断开 Telnet 连接，并将执行结果显示在状态栏信息框中。
4. **结果显示信息区域**
    - **结果信息框**：设计一个只读的文本框用于显示执行过程的结果信息，该文本框设置为灰色不可编辑状态，旁边添加标签 “执行结果”。
    - 执行结果的标签名放信息框的左上角显示


#### Telnet 连接功能
1. **连接建立**
    - **信息验证**：当用户点击 “执行” 按钮时，首先验证输入信息的合法性。IP 地址必须符合标准的 IPv4 格式，端口号应在 1 - 65535 的范围内，端口号从 `cmd.xml` 文件的 `<port>` 字段获取。
    - **连接尝试**：使用 Python 的 `telnetlib` 库尝试建立 Telnet 连接。
    - **连接结果反馈**：若连接成功，在状态栏信息框中显示 “连接成功”；若连接失败，显示具体的错误信息，如网络连接失败、主机不可达、认证失败等。
2. **命令交互**
    - **获取提示符**：若 Telnet 连接成功，这一次，等待 300 毫秒后读取所有返回信息并显示在状态栏信息框中。将返回信息去除 `\r` 和 `\n` 字符后，作为命令执行完的提示符，保存到变量 `prompt` 中。
    - **获取命令**：从 `cmd.xml` 文件的 `<commands>` 获取命令，命令可以是多行。
    - **命令执行**：每次获取一行命令内容（包含换行符），发送到远程主机执行。
    - **结果显示**：发送命令后，等待命令执行完成，执行完成判断条件为返回内容包含 `prompt`变量内容，读取执行结果并显示在状态栏信息框中。
    - **字符处理**：支持中文输入和显示，忽略 Linux shell 返回的终端文本显示控制特殊转义字符，避免显示乱码。
    - **文本框操作**：每次有新内容输入或回车时，新内容在状态栏信息框的末尾显示，并且光标自动跳转到末尾。


#### 异常处理
1. **连接异常**：在连接过程中，捕获并处理可能出现的异常，如网络连接失败、主机不可达、认证失败等。将详细的错误信息显示在状态栏信息框中。
2. **命令执行异常**：在命令执行过程中，处理可能出现的异常，如命令无效、权限不足等。在状态栏信息框中给出相应的错误提示。


### 代码结构要求
1. **模块化设计**
    - 将不同的功能模块封装成独立的函数或类，以提高代码的可读性、可维护性，便于后续的扩展和修改。
    - 分别创建 Telnet 通信功能类、配置文件管理类和 UI 功能类来管理各自的功能。
2. **代码注释**：在代码中添加必要的注释，详细解释关键部分的功能和实现思路，增强代码的可理解性。


### 代码输出要求
- 代码应具备完整的结构，包含必要的导入语句、类和函数定义、主程序入口等，确保可以直接运行。
- 提供的 `cmd.xml` 文件内容应符合上述配置文件要求。