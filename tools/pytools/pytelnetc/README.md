## 目的
实现一个telnet客户端demo

## 工具说明
- **使用工具**：vscode、marscode（插件，豆包）
- **借鉴资源**：deepseek

## 提示词
请根据以下需求生成完整可运行的 Python 代码

### 需求概述
使用 Python 开发一个类似 Xshell 的 Telnet 客户端桌面应用程序。该应用需具备基本的 Telnet 连接功能，允许用户输入目标主机的 IP 地址、端口号、用户名和密码以建立连接，并在界面上展示与远程主机的交互信息。

### 详细功能需求

#### 界面设计
1. **主窗口**
    - 窗口标题：“Telnet 客户端”
    - 布局要求：采用合理布局，确保各组件清晰展示，提升用户体验，且所有组件布局支持窗口缩放，能随窗口大小自适应。

2. **连接信息输入区域**
    - 输入框设计：四个输入框，分别用于输入目标主机的 IP 地址、端口号、用户名和密码。
    - 标签配备：为每个输入框配备对应标签，明确提示用户输入内容。
    - 默认值设置：
        - IP 地址：172.20.122.66
        - 端口号：23
        - 用户名：root
        - 密码：4001862505

3. **连接操作按钮**
    - 按钮功能：创建 “连接” 按钮，点击该按钮时，应用程序依据用户输入信息尝试建立 Telnet 连接。

4. **命令与信息输出显示区域**
    - 区域功能：设计多行文本区域，用于显示与远程主机的交互信息，包括连接状态、命令执行结果等。

#### Telnet 连接功能
1. **连接建立**
    - 信息验证：用户点击 “连接” 按钮时，先验证输入信息的合法性（如 IP 地址格式、端口号范围等）。
    - 连接尝试：使用 Python 的 `telnetlib` 库尝试建立 Telnet 连接。
    - 结果显示：
        - 连接成功：在输出显示区域显示 “连接成功” 提示信息。
        - 连接失败：显示具体错误信息。
    - 按钮状态：点击连接按键后变成“连接中”，如果连接成功则变成“断开连接”，如果连接失败则变成“连接”。

2. **命令交互**
    - 初始读取：若 Telnet 连接成功，等待 300ms 后读取所有返回信息并显示，将返回信息（去除 `\r` 和 `\n` 字符）作为命令执行完的提示符，保存到变量 `prompt` 中。
    - 自动发送：登录成功后，自动发送一个换行符给远程主机，然后正常显示其返回结果。
    - 命令输入：用户在多行文本区域输入命令并按下回车键时，将用户输入命令（包含回车符本身，命令内容如果包含 `prompt` 则取最后一个 `prompt` 往后的内容）保存到变量 `command` 中，然后将 `command` 内容发送给远程主机。
    - 结果读取：发送命令后，等待命令执行完成的提示符 `prompt`，读取结果并显示。
    - 输入方式：命令输入不考虑单独输入框。
    - 结果显示：
        - 不重复显示命令本身，因为 Telnet 返回内容开始会把输入的命令进行回显。
        - 显示完内容后，原本回车键不再进行显示。
        - 命令执行结果支持多行信息同时显示，同时保留历史信息显示。
    - 字符支持：支持中文输入和显示。
    - 转义处理：忽略 Linux shell 返回的终端文本显示控制特殊转义字符，避免显示乱码。
    - 光标控制：每次有新内容输入或回车，在文本区域末尾显示，光标跳转到最新输入处。

#### 异常处理
1. **连接异常**
    - 异常捕获：捕获并处理连接过程中可能出现的异常，如网络连接失败、主机不可达、认证失败等。
    - 信息显示：在输出显示区域显示详细错误信息。

2. **命令执行异常**
    - 异常处理：处理命令执行过程中可能出现的异常，如命令无效、权限不足等。
    - 提示显示：在输出显示区域给出相应错误提示。

### 代码结构要求
1. **模块化设计**
    - 功能封装：将不同功能模块封装成独立的函数或类，提高代码的可读性、可维护性，便于后续扩展和修改。
    - 类管理：将 Telnet 通信功能与 UI 功能分别封装在不同的类中进行管理。

2. **代码注释**
    - 注释添加：在代码中添加必要注释，详细解释关键部分的功能和实现思路，增强代码的可理解性。

## 迭代
1. 基于上面提示词生成的代码，继续优化，提示词：使用多线程提升连接及读写指令的交互体验
2. 继续优化，提示词：将 Telnet 通信功能与 UI 功能分别封装在不同的类中进行管理。

